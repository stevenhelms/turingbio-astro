---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout title="Therapeutic & Diagnostic Pipeline">
  <section class="pipeline">
    <div class="container">
      <div class="section-header">
        <h2>Available Therapeutic & Diagnostic Assets by Disease</h2>
        <p>68 therapeutic and diagnostic assets across 7 major disease categories.</p>
      </div>
      <div class="pipeline-controls">
        <div class="filters">
          <select id="disease-filter" aria-label="Filter by disease">
            <option value="all">All Diseases</option>
            <option value="autoimmune">Autoimmune</option>
            <option value="metabolic">Metabolic</option>
            <option value="neurological">Neurological</option>
            <option value="oncology">Oncology</option>
            <option value="cardiovascular">Cardiovascular</option>
            <option value="genetic">Rare Genetic</option>
          </select>
          <select id="stage-filter" aria-label="Filter by development stage">
            <option value="all">All Stages</option>
            <option value="discovery">Discovery</option>
            <option value="preclinical">Preclinical</option>
            <option value="phase1">Phase I</option>
            <option value="phase2">Phase II</option>
            <option value="phase3">Phase III</option>
            <option value="launched">Launched</option>
          </select>
          <input id="search-input" type="search" placeholder="Search asset or indication" aria-label="Search" />
        </div>
        <div class="legend">
          <span class="legend-item"><span class="dot discovery"></span>Discovery</span>
          <span class="legend-item"><span class="dot preclinical"></span>Preclinical</span>
          <span class="legend-item"><span class="dot phase1"></span>Phase I</span>
          <span class="legend-item"><span class="dot phase2"></span>Phase II</span>
          <span class="legend-item"><span class="dot phase3"></span>Phase III</span>
          <span class="legend-item"><span class="dot launched"></span>Launched</span>
        </div>
      </div>

      <div class="pipeline-grid" id="pipeline-grid">
        <!-- Example asset cards; in production, render from data -->
        <div class="asset-card" data-disease="autoimmune" data-stage="phase2" data-name="Nexus-AI-101">
          <div class="asset-header">
            <h4>Nexus-AI-101</h4>
            <span class="badge phase2">Phase II</span>
          </div>
          <div class="asset-meta">
            <div class="meta-row"><span>Indication</span><strong>Rheumatoid Arthritis</strong></div>
            <div class="meta-row"><span>Modality</span><strong>Metabolite Therapeutic</strong></div>
          </div>
          <div class="progress">
            <div class="bar phase2" style="width: 66%"></div>
          </div>
        </div>

        <div class="asset-card" data-disease="metabolic" data-stage="preclinical" data-name="Nexus-MB-204">
          <div class="asset-header">
            <h4>Nexus-MB-204</h4>
            <span class="badge preclinical">Preclinical</span>
          </div>
          <div class="asset-meta">
            <div class="meta-row"><span>Indication</span><strong>NAFLD/NASH</strong></div>
            <div class="meta-row"><span>Modality</span><strong>Diagnostic Panel</strong></div>
          </div>
          <div class="progress">
            <div class="bar preclinical" style="width: 33%"></div>
          </div>
        </div>

        <div class="asset-card" data-disease="oncology" data-stage="phase1" data-name="Nexus-ON-318">
          <div class="asset-header">
            <h4>Nexus-ON-318</h4>
            <span class="badge phase1">Phase I</span>
          </div>
          <div class="asset-meta">
            <div class="meta-row"><span>Indication</span><strong>Colorectal Cancer</strong></div>
            <div class="meta-row"><span>Modality</span><strong>Companion Diagnostic</strong></div>
          </div>
          <div class="progress">
            <div class="bar phase1" style="width: 50%"></div>
          </div>
        </div>

        <div class="asset-card" data-disease="neurological" data-stage="launched" data-name="Nexus-NR-022">
          <div class="asset-header">
            <h4>Nexus-NR-022</h4>
            <span class="badge launched">Launched</span>
          </div>
          <div class="asset-meta">
            <div class="meta-row"><span>Indication</span><strong>Parkinson's Disease</strong></div>
            <div class="meta-row"><span>Modality</span><strong>Screening Assay</strong></div>
          </div>
          <div class="progress">
            <div class="bar launched" style="width: 100%"></div>
          </div>
        </div>

        <div class="asset-card" data-disease="cardiovascular" data-stage="discovery" data-name="Nexus-CV-110">
          <div class="asset-header">
            <h4>Nexus-CV-110</h4>
            <span class="badge discovery">Discovery</span>
          </div>
          <div class="asset-meta">
            <div class="meta-row"><span>Indication</span><strong>Hypertrophic Cardiomyopathy</strong></div>
            <div class="meta-row"><span>Modality</span><strong>Small Molecule</strong></div>
          </div>
          <div class="progress">
            <div class="bar discovery" style="width: 10%"></div>
          </div>
        </div>

        <div class="asset-card" data-disease="genetic" data-stage="phase3" data-name="Nexus-GN-451">
          <div class="asset-header">
            <h4>Nexus-GN-451</h4>
            <span class="badge phase3">Phase III</span>
          </div>
          <div class="asset-meta">
            <div class="meta-row"><span>Indication</span><strong>Duchenne Muscular Dystrophy</strong></div>
            <div class="meta-row"><span>Modality</span><strong>Metabolic Modulator</strong></div>
          </div>
          <div class="progress">
            <div class="bar phase3" style="width: 83%"></div>
          </div>
        </div>
      </div>

      <p class="results-note">Note: Representative sample of assets. Full pipeline available upon request.</p>
    </div>
  </section>
</BaseLayout>

<style>
  .pipeline .pipeline-controls {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .pipeline .filters {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .pipeline select,
  .pipeline input[type="search"] {
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    padding: 0.75rem 1rem;
    background: var(--bg-primary);
    color: var(--text-primary);
  }

  .pipeline .legend {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    color: var(--text-secondary);
  }

  .legend-item { display: inline-flex; align-items: center; gap: 0.5rem; }
  .legend-item .dot { width: 10px; height: 10px; border-radius: 999px; display: inline-block; }
  .dot.discovery { background: #a78bfa; }
  .dot.preclinical { background: #60a5fa; }
  .dot.phase1 { background: #34d399; }
  .dot.phase2 { background: #f59e0b; }
  .dot.phase3 { background: #ef4444; }
  .dot.launched { background: #10b981; }

  .pipeline-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
  }

  .asset-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 1.25rem;
    box-shadow: var(--shadow-sm);
  }

  .asset-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem; }
  .asset-header h4 { font-size: 1.125rem; font-weight: 700; color: var(--text-primary); }

  .badge { padding: 0.25rem 0.5rem; border-radius: var(--radius); font-size: 0.75rem; font-weight: 700; color: #fff; }
  .badge.discovery { background: #a78bfa; }
  .badge.preclinical { background: #60a5fa; }
  .badge.phase1 { background: #34d399; }
  .badge.phase2 { background: #f59e0b; }
  .badge.phase3 { background: #ef4444; }
  .badge.launched { background: #10b981; }

  .asset-meta { display: grid; gap: 0.5rem; margin-bottom: 0.75rem; }
  .meta-row { display: flex; align-items: center; justify-content: space-between; color: var(--text-secondary); }
  .meta-row strong { color: var(--text-primary); }

  .progress { background: var(--bg-secondary); height: 8px; border-radius: 999px; overflow: hidden; }
  .bar { height: 100%; }
  .bar.discovery { background: #a78bfa; }
  .bar.preclinical { background: #60a5fa; }
  .bar.phase1 { background: #34d399; }
  .bar.phase2 { background: #f59e0b; }
  .bar.phase3 { background: #ef4444; }
  .bar.launched { background: #10b981; }

  .results-note { color: var(--text-light); margin-top: 1rem; }

  @media (max-width: 768px) {
    .pipeline .filters { flex-direction: column; }
  }
</style>

<script>
  const grid = document.getElementById('pipeline-grid');
  const diseaseFilter = document.getElementById('disease-filter');
  const stageFilter = document.getElementById('stage-filter');
  const searchInput = document.getElementById('search-input');

  function applyFilters() {
    const disease = diseaseFilter.value;
    const stage = stageFilter.value;
    const search = searchInput.value.trim().toLowerCase();

    const cards = Array.from(grid.querySelectorAll('.asset-card'));
    cards.forEach(card => {
      const cardDisease = card.getAttribute('data-disease');
      const cardStage = card.getAttribute('data-stage');
      const cardName = card.getAttribute('data-name')?.toLowerCase() || '';
      const cardText = card.textContent.toLowerCase();

      const matchesDisease = disease === 'all' || disease === cardDisease;
      const matchesStage = stage === 'all' || stage === cardStage;
      const matchesSearch = !search || cardName.includes(search) || cardText.includes(search);

      if (matchesDisease && matchesStage && matchesSearch) {
        card.style.display = '';
      } else {
        card.style.display = 'none';
      }
    });
  }

  diseaseFilter?.addEventListener('change', applyFilters);
  stageFilter?.addEventListener('change', applyFilters);
  searchInput?.addEventListener('input', applyFilters);
</script>

